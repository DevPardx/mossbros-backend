# CHANGELOG
<!-- Latest on top -->

## [1.0.0] 2025-11-13
### Added - Production Infrastructure
- **Security Enhancements** (`src/server.ts`)
  - Added helmet middleware for security headers (XSS protection, HSTS, etc.)
  - Added compression middleware for response optimization
  - Both middlewares now active in production environment

- **Error Tracking and Monitoring** (Sentry Integration)
  - Created `src/config/sentry.ts` for centralized Sentry configuration
  - Integrated Sentry error capture in error middleware (`src/middleware/error.ts`)
  - Automatic error tracking for 500+ errors in production
  - Performance monitoring with profiling integration
  - Initialized Sentry in application startup (`src/index.ts`)

- **Production Environment Configuration**
  - Created `.env.production.example` with comprehensive production variables
  - Documented all required environment variables with security notes
  - Added Sentry DSN configuration
  - Included SMTP configuration for production email services

- **Automated Backup System**
  - Created `scripts/backup-database.sh` for automated PostgreSQL backups
    - Compressed SQL dumps with gzip
    - 7-day retention policy (configurable)
    - Logging to `/var/log/mossbros-backup.log`
    - Docker-based backup execution
  - Created `scripts/restore-database.sh` for database recovery
    - Safety backup before restore
    - Verification after restore
    - Automatic rollback on failure
  - Created `scripts/setup-cron-backup.sh` for automated scheduling
    - Daily backups at 2:00 AM via cron

- **CI/CD Pipeline** (`.github/workflows/deploy.yml`)
  - Automated build and push to GitHub Container Registry
  - Automated deployment to DigitalOcean via SSH
  - Health checks after deployment
  - Automatic image cleanup
  - Triggers on push to main branch

- **Alternative Deployment Options**
  - Created `ecosystem.config.js` for PM2 deployment
    - Cluster mode with max CPU utilization
    - Auto-restart and memory limits
    - Log management and rotation
  - Created `scripts/mossbros.service` for systemd service
    - System service with auto-start on boot
    - Resource limits and security hardening

### Changed
- **Logging Improvements** (`src/utils/logger.ts`)
  - Updated Winston to use JSON format for production
  - Structured logging for better parsing and analysis
  - Maintains human-readable format in development

- **Redis Persistence** (`docker-compose.prod.yml`)
  - Enabled AOF (Append-Only File) persistence
  - Configured RDB snapshots with 3 strategies:
    - Save after 900s if ≥1 key changed
    - Save after 300s if ≥10 keys changed
    - Save after 60s if ≥10,000 keys changed
  - Ensures cache and session data persist across restarts

### Dependencies
- Added `@sentry/node` (^8.45.1) for backend error tracking
- Added `@sentry/profiling-node` (^8.45.1) for performance monitoring

## [1.0.0] 2025-11-12
### Added
- **Repair Job History Filtering System** (`src/services/repairJob.service.ts`)
  - Separate endpoints for active repairs and completed/cancelled history
  - `getAll()` now excludes completed and cancelled repair jobs
  - `getHistory()` now only includes completed and cancelled repair jobs
  - Exact date filtering in history using PostgreSQL date casting (`::date`)
  - COALESCE fallback to `updated_at` for jobs without `completed_at`
  - Smart date parsing with timezone handling to prevent offset issues

- **Completed Date on Cancellation** (`src/services/repairJob.service.ts`)
  - `cancel()` method now sets `completed_at` timestamp when cancelling jobs
  - Ensures all cancelled jobs have a completion date for filtering

### Changed
- **Code Cleanup and Quality Improvements**
  - Removed 10 debug logs and descriptive comments from backend codebase
  - Cleaned up `console.log`, `console.error` statements
  - Removed commented-out code in seed files
  - Maintained eslint directives and TypeScript comments
  - Files cleaned: `repairJob.service.ts`, `customer.service.ts`, `rateLimiter.ts`, `RepairJob.entity.ts`, `database/seeds/index.ts`

### Fixed
- **History Date Filtering Accuracy**
  - Fixed date comparison to use exact date matching (ignoring time component)
  - Resolved timezone issues in date filtering with proper PostgreSQL casting
  - History filters now work with exact calendar dates (e.g., job completed Nov 12 won't show when filtering from Nov 13)

## [1.0.0] 2025-11-07
### Fixed
- **RepairJob Date Handling** (`src/services/repairJob.service.ts`)
  - Fixed timezone issues in `update()` method
  - Changed from converting date string to Date object to passing string directly
  - Allows entity transformer to handle date conversion properly
  - Prevents timezone offset bugs when storing date-only values
  - Ensures YYYY-MM-DD format is preserved throughout the update flow
  - More consistent with the create flow's date handling

### Changed
- **RepairJob Service** (`src/services/repairJob.service.ts`)
  - Updated `update()` method to pass `estimated_completion` as string
  - Removed manual `new Date()` conversion that caused timezone issues
  - Entity transformer now handles all date conversions consistently

## [1.0.0] 2025-11-03
### Added - Multiple Motorcycles Per Customer
- **One-to-Many Customer-Motorcycle Relationship**: Complete refactoring from one-to-one to one-to-many pattern
  - Customers can now own unlimited motorcycles instead of just one
  - Motorcycle entities maintain foreign key relationship to customer
  - Automatic cascade deletion when customer is removed
  - Full support for multiple motorcycle operations (create, read, update, delete)

- **Enhanced Validation System**
  - Array validation for motorcycles using express-validator wildcards (`motorcycles.*.field_name`)
  - Minimum 1 motorcycle requirement for customer creation and updates
  - Duplicate plate detection across all submitted motorcycles in single request
  - Smart exclusion of customer's own motorcycles from duplicate checks during updates
  - Validation only runs for fields that are actually changing (phone/email)

- **Transaction-Based Motorcycle Management**
  - Atomic replacement of all customer motorcycles during updates
  - Delete old motorcycles and insert new ones in single transaction
  - Rollback protection if any motorcycle creation fails
  - Database consistency guaranteed through transaction boundaries

### Changed
- **Database Schema Migration**
  - `Customer` entity: Changed `@OneToOne` to `@OneToMany` for motorcycles relationship
  - `Customer` entity: Renamed `motorcycle` field to `motorcycles` (array)
  - `Motorcycle` entity: Changed `@OneToOne` to `@ManyToOne` for customer relationship
  - No migration required - TypeORM handles relationship changes automatically

- **Type Definitions Enhanced** (`src/types/index.ts`)
  - Added `MotorcycleInputType` for form submissions with individual motorcycle data
  - Updated `CustomerWithMotorcycleType` from single motorcycle to `motorcycles: MotorcycleInputType[]`
  - Maintained backward compatibility with existing response types

- **Customer Service Refactored** (`src/services/customer.service.ts`)
  - `create()`: Now handles multiple motorcycles in single transaction
    - Validates at least 1 motorcycle is provided
    - Creates all motorcycles atomically with customer
    - Success message shows motorcycle count (e.g., "con 3 motocicletas")
  - `update()`: Replaces all motorcycles using delete-then-insert pattern
    - Smart validation only for changed fields (phone, email)
    - Compares new values with existing customer data
    - Prevents false duplicate errors when keeping same data
  - `validateDuplicates()`: Enhanced with smart filtering
    - Checks for duplicate plates within same request
    - Filters out current customer's motorcycles during updates
    - Only validates phone/email if values are actually changing
    - Accepts optional `excludeCustomerId` parameter for update operations
  - `getAll()`, `search()`, `getById()`: Load `motorcycles` array with full relations
    - Eager loading of brand and model for each motorcycle
    - Maintains ordering by creation date
  - Helper methods updated:
    - `buildMotorcycleData()`: Now accepts individual motorcycle input
    - `validateDuplicates()`: Added smart change detection logic

- **Route Validators Updated** (`src/routes/customers.ts`)
  - POST `/customers`: Changed from single motorcycle to array validation
    - `body("motorcycles").isArray({ min: 1 })` ensures at least one motorcycle
    - `body("motorcycles.*.motorcycle_plate")` validates each plate in array
    - `body("motorcycles.*.brand_id")` validates each brand UUID
    - `body("motorcycles.*.model_id")` validates each model UUID
  - PUT `/customers/:id`: Same array validation as POST route
    - Supports updating customer with new motorcycle list
    - Email validation changed to `.optional()` for consistency

### Fixed
- **False Duplicate Validation Errors**
  - No longer throws "motorcycle plate already exists" when updating customer with same motorcycles
  - No longer throws "phone already exists" when updating customer without changing phone
  - No longer throws "email already exists" when updating customer without changing email
  - Proper filtering excludes current customer's data from duplicate checks

- **Type Safety Improvements**
  - Fixed `existingMotorcycles[0]?.plate` with nullish coalescing operator
  - Added proper type guards for array access
  - All TypeScript compilation errors resolved

- **Validation Logic**
  - Phone validation now wrapped in conditional check (only validates if provided)
  - Email validation only runs when value is different from current
  - Motorcycle validation excludes customer's own motorcycles by customer_id

## [1.0.0] 2025-11-2
### Added - Infrastructure & Documentation
- **Structured Logging System with Winston**: Professional logging infrastructure for development and production
  - Created `utils/logger.ts` with Winston configuration
    - Environment-specific formats: colorized console for development, file logging for production
    - Log levels: error, warn, info, debug (debug in dev, info in prod)
    - Production file rotation with size and count limits (5MB max, 5 files)
    - Separate error.log and combined.log files for production
    - Stream export for Morgan HTTP logging integration
    - Event handlers for connect, disconnect, and error events
  - Integrated Winston with Morgan for HTTP request logging
    - Changed Morgan format from "dev" to "combined" for production-ready logs
    - Winston stream adapter for unified logging output
  - Added logs/ directory to .gitignore for log file exclusion

- **Redis Configuration and Caching Infrastructure**
  - Enhanced `config/redis.ts` with Winston logger integration
  - Added event handlers: connect, disconnect, and error events
  - Created `utils/cache.ts` with comprehensive caching utilities
    - `CacheService` class with type-safe methods: get, set, del, exists, delPattern, flush
    - `getOrSet()` method implementing cache-aside pattern
    - `CacheKeys` object for consistent key naming conventions
    - `CacheTTL` constants for different expiration times (SHORT, MEDIUM, LONG, DAY)
    - Graceful error handling with automatic fallbacks

- **Rate Limiting System with Redis Store**
  - Installed `express-rate-limit` and `rate-limit-redis` packages
  - Created `middleware/rateLimiter.ts` with factory functions for rate limiters
    - `createGeneralLimiter()`: 100 requests per 15 minutes for all routes
    - `createAuthLimiter()`: 5 requests per 15 minutes for login endpoint
    - `createPasswordResetLimiter()`: 3 requests per hour for password reset
  - Implemented Redis-backed rate limiting with persistent storage
  - Added Spanish error messages for rate limit violations
  - Integrated rate limiters into server initialization flow
  - Applied specific rate limiters to auth routes (login, forgot-password, reset-password)
  - Added logging for rate limit violations (IP tracking)

- **Complete Swagger/OpenAPI Documentation**
  - Installed `swagger-ui-express` and `swagger-jsdoc` packages
  - Created `config/swagger.ts` with comprehensive OpenAPI 3.0 specification
    - Environment-aware server URLs (development/production)
    - Cookie-based authentication scheme definition
    - Complete component schemas: Brand, Model, Service, Customer, RepairJob, PaginatedResponse, Error
    - Reusable response components: UnauthorizedError, NotFoundError, BadRequestError, RateLimitError
    - 6 API tags for organized documentation sections
  - Added JSDoc annotations to ALL 42 endpoints across 6 route files:
    - **Authentication routes** (7 endpoints): login, forgot-password, reset-password, logout, verify, profile
    - **Brands routes** (5 endpoints): create, get all, get by ID, update, delete
    - **Models routes** (5 endpoints): create, get by brand, get by ID, update, delete
    - **Services routes** (5 endpoints): create, get all, get by ID, update, delete
    - **Customers routes** (6 endpoints): create, search, get all, get by ID, update, delete
    - **Repair Jobs routes** (9 endpoints): create, get all, statistics, get by ID, update, update status, cancel, workflow, delete
  - Integrated Swagger UI at `/api-docs` endpoint with custom styling
  - Added health check endpoint at `/health` for monitoring
  - Complete request/response schemas with examples for all endpoints
  - Parameter descriptions with types, formats, and validation rules

### Changed
- **Server Startup Logging Enhanced**
  - Replaced all console.log with structured logger calls in server.ts, index.ts, and config/env.ts
  - Removed colors package dependency in favor of Winston colorization
  - Database connection: logger.info() with proper success/error handling
  - Seed status: logger.info() for running/completed, logger.warn() for skipped
  - Error handling: logger.error() with error object metadata
  - Redis connection: logger.info() for successful connection

- **Error Middleware Logging Improved**
  - Updated error.ts middleware to use Winston logger
  - Conditional logging based on error severity:
    - AppError with statusCode >= 500: logger.error() with stack trace
    - AppError with statusCode < 500: logger.warn() without stack
  - Unexpected errors: logger.error() with full error object
  - Removed console.error in favor of structured logging

- **Rate Limiter Architecture Refactored**
  - Converted from static rate limiter instantiation to factory pattern
  - Rate limiters now initialized after Redis connection (prevents ClientClosedError)
  - Added `initializeRateLimiters()` function exported from server.ts
  - Updated auth routes to accept optional rate limiter parameters
  - Applied conditional middleware checks for graceful degradation

- **Authentication Routes Enhanced**
  - Updated `createAuthRoutes()` to accept optional authLimiter and passwordResetLimiter parameters
  - Dynamically applies rate limiters only when available
  - Maintains backward compatibility with optional parameters

- **ESLint Configuration Updated**
  - Modified `eslint.config.mts` to properly ignore dist/ and node_modules/ directories
  - Separated ignores configuration into dedicated object for flat config format

### Fixed
- **Circular Dependency Resolution**
  - Fixed circular import between `utils/logger.ts` and `config/env.ts`
  - Changed logger to use `process.env.NODE_ENV` directly instead of importing from env module
  - Prevents "Cannot read properties of undefined" errors on startup

- **Redis Client Initialization Timing**
  - Fixed ClientClosedError when rate limiters tried to use Redis before connection
  - Implemented factory pattern for rate limiters with lazy initialization
  - Rate limiters now created after Redis connects in main() function
  - Proper initialization order: Environment → Redis → Rate Limiters → Database → Routes

- **Type Safety Improvements**
  - Resolved Redis client type conflicts by using `any` type with ESLint exemption
  - Fixed "Variable used before being assigned" errors with proper optional types
  - All rate limiter variables properly typed as `RateLimitRequestHandler | undefined`

### Removed
- **Deprecated Dependencies**
  - Uninstalled `colors` package (replaced by Winston colorization)
  - Removed all `colors` imports from codebase (server.ts, index.ts, config/env.ts)

## [1.0.0] 2025-11-2
### Added
- **Error Handling Utilities**: Created reusable utility functions for consistent error handling
  - Created `utils/asyncHandler.ts` with async error wrapper utilities
    - `catchAsync()`: Express middleware wrapper that automatically catches and forwards errors
    - `catchServiceError()`: Service method wrapper that transforms errors consistently
  - Created `utils/validation.utils.ts` with type-safe validation helpers
    - `assertExists()`: Type-safe existence validation with automatic type narrowing
    - `assertTrue()`: Boolean condition validation
    - `assertNotEmpty()`: Array emptiness validation
    - `assertSameLength()`: Array length comparison validation
    - `assertIsOneOf()`: Enum/set membership validation
  - Created `utils/response.utils.ts` with standardized response formatters
    - `sendSuccess()`, `sendCreated()`, `sendNoContent()`: Standardized response helpers
    - `createPaginatedResponse()`: Pagination response builder
    - `calculatePagination()`: Pagination metadata calculator

- **Helper Methods in RepairJobService**: Extracted 8 complex methods for better maintainability
  - `calculatePercentageChange()`: Percentage change calculation with zero handling
  - `getMonthBoundaries()`: Date boundary calculation for month ranges
  - `getCompletedJobsInPeriod()`: Query completed jobs within date range
  - `getNewCustomersCountInPeriod()`: Count new customers in date range
  - `calculateRevenueFromJobs()`: Revenue aggregation from job array
  - `calculateTotalCost()`: Total cost calculation from services
  - `isComplexRepair()`: Complex repair detection based on keywords
  - `calculateEstimatedCompletion()`: Estimated completion date calculation

- **Helper Methods in CustomerService**: Extracted 3 methods for cleaner transaction handling
  - `validateDuplicates()`: Centralized duplicate checking for customer and motorcycle
  - `buildCustomerData()`: Customer data object transformation
  - `buildMotorcycleData()`: Motorcycle data object transformation

### Changed
- **RepairJobService.getStatistics() Refactored**
  - Reduced from 90+ lines to ~50 lines using extracted helper methods
  - Improved performance with parallel Promise.all() queries for current and previous month data
  - Enhanced readability with clear separation of concerns
  - Better testability with isolated calculation methods

- **CustomerService.create() Refactored**
  - Separated validation logic into `validateDuplicates()` method
  - Extracted data transformation into builder methods
  - Simplified main create flow for better readability
  - Maintained transactional integrity with cleaner code structure

- **BrandService Enhanced with Validation Utilities**
  - Replaced manual null checks with `assertExists()` calls
  - Replaced if-throw patterns with `assertTrue()` calls
  - Cleaner, more declarative validation code
  - Better error messages with consistent formatting

- **RepairJobService Enhanced with Validation Utilities**
  - Applied `assertExists()` for motorcycle validation
  - Applied `assertSameLength()` for service validation
  - Reduced boilerplate error handling code
  - More focused business logic

## [1.0.0] 2025-10-30
### Added - Dependency Injection Architecture
- **Service Container System**: Centralized dependency management for the entire application
  - Created `ServiceContainer` class for managing all service instances with lazy initialization
  - Type-safe service instantiation with proper dependency injection
  - Centralized repository access through container getters
  - Clean separation of concerns between services, controllers, and routes
  - Support for easy service mocking and testing through constructor injection

- **Factory Pattern for Routes**: All route files now use factory functions
  - Route factory functions accept `ServiceContainer` as parameter
  - Dynamic route initialization after database connection
  - Controllers instantiated with properly injected service dependencies
  - Improved modularity and testability of route configurations

### Changed
- **All Services Refactored to Instance-Based Pattern** (6 services total)
  - `BrandService`: Converted from static methods to constructor-injected repository
  - `ModelService`: Converted from static methods to constructor-injected repository
  - `ServiceService`: Converted from static methods to constructor-injected repository
  - `CustomerService`: Converted from static to instance with DataSource injection for transactions
  - `AuthService`: Converted from static methods to constructor-injected repository
  - `RepairJobService`: Converted from static to instance with multiple repository dependencies
  - All service methods now use instance properties instead of static AppDataSource access
  - Added proper return type annotations for all service methods

- **All Controllers Refactored to Use Dependency Injection** (6 controllers total)
  - `BrandController`: Converted to instance-based with injected `BrandService`
  - `ModelController`: Converted to instance-based with injected `ModelService`
  - `ServiceController`: Converted to instance-based with injected `ServiceService`
  - `CustomerController`: Converted to instance-based with injected `CustomerService`
  - `AuthController`: Converted to instance-based with injected `AuthService`
  - `RepairJobController`: Converted to instance-based with injected `RepairJobService`
  - Added `Promise<Response>` return type annotations for all controller methods
  - Controllers no longer access services through static methods

- **Route Files Converted to Factory Pattern** (6 route files total)
  - `brands.ts` → `createBrandRoutes(container)` factory function
  - `models.ts` → `createModelRoutes(container)` factory function
  - `services.ts` → `createServiceRoutes(container)` factory function
  - `customers.ts` → `createCustomerRoutes(container)` factory function
  - `auth.ts` → `createAuthRoutes(container)` factory function
  - `repairJobs.ts` → `createRepairJobRoutes(container)` factory function
  - All routes now instantiate controllers with service dependencies

- **Server Configuration Enhanced**
  - Added `ServiceContainer` initialization after database connection
  - Routes now set up dynamically in `setupRoutes()` function after container initialization
  - All route imports changed from default exports to named factory function imports
  - Proper initialization order: DB → Container → Routes → Middleware

### Technical Improvements
- **Improved Testability**: Services can now be easily mocked and tested in isolation
- **Explicit Dependencies**: All dependencies are now clearly defined in constructors
- **Better Type Safety**: Full TypeScript type checking with explicit service types
- **Maintainability**: Easier to understand and modify service dependencies
- **Flexibility**: Simple to swap implementations or add new dependencies
- **Zero Breaking Changes**: Application functionality remains completely identical
- **Clean Architecture**: Better separation between layers (routes → controllers → services)

### Fixed
- Removed unused repository injections where not needed (simplified constructors)
- Removed unused import statements (`Brand` from ModelService, `DataSource` from RepairJobService)
- Fixed all TypeScript compilation warnings for unused parameters

## [1.0.0] 2025-10-30
### Added - Production Safety & Configuration Management
- **Environment Validation System**: Comprehensive startup validation for all required environment variables
  - Added `validateEnv()` function to check all required environment variables before startup
  - Added security warnings for production environment (weak passwords, short JWT secrets)
  - Application exits with clear error messages if required variables are missing
  - Added `.env.example` file with comprehensive documentation for all environment variables
  - Centralized environment configuration in `config/env.ts` with typed exports

- **Production-Safe Database Configuration**
  - Database schema synchronization now disabled in production (prevents accidental data loss)
  - Added migration support with automatic migration execution in production
  - Configured connection pooling for production environments (max: 20, min: 5 connections)
  - Added proper entity path resolution for both development (.ts) and production (.js) files
  - Enhanced database logging with environment-specific log levels

- **Centralized Configuration System**
  - Created `config/constants.ts` with all application-wide configuration constants
  - Repair estimation configuration: base days per service, complexity multipliers, and keywords
  - JWT configuration: token expiration times and cookie settings
  - Password security configuration: bcrypt rounds, min/max length
  - Pagination configuration: default page size, limits
  - Rate limiting configuration: general, auth, and password reset limits
  - File upload configuration: max size, allowed MIME types, upload path
  - Email configuration: from address, template names
  - Business rules configuration: deletable statuses, cancellation rules, notification triggers
  - API configuration: version, prefix paths
  - Created `config/index.ts` for unified configuration exports

- **TypeScript Strict Mode Enhancement**
  - Enabled strict type checking across the entire codebase
  - Added `noUnusedLocals` to catch unused variables
  - Added `noUnusedParameters` to catch unused function parameters
  - Added `noImplicitReturns` to ensure all code paths return values
  - Added `noFallthroughCasesInSwitch` to prevent accidental fallthrough
  - Added `noUncheckedIndexedAccess` for safer array/object access
  - Added `skipLibCheck` for faster compilation
  - Added `forceConsistentCasingInFileNames` for cross-platform compatibility

### Changed
- **Conditional Database Seeding**: Seeds now only run in development environment
  - Added environment check before running `runAllSeeds()`
  - Added colored console logging for seed status
  - Application exits with error code 1 if database connection fails
  - Prevents accidental data corruption in production environments

- **Enhanced Configuration Usage Across Services**
  - Updated `RepairJobService` to use `REPAIR_ESTIMATION` constants for calculation logic
  - Updated `RepairJobService` to use `BUSINESS_RULES.DELETABLE_STATUSES` for deletion validation
  - Updated password hashing to use `PASSWORD_CONFIG.BCRYPT_ROUNDS` (increased from 10 to 12)
  - Updated JWT token generation to use `JWT_CONFIG.EXPIRATION` constants
  - Updated all config files to use centralized `env` module instead of `process.env`
  - Replaced hardcoded magic numbers with named constants throughout the codebase

- **Improved Type Safety**
  - Added `WorkflowRule` interface for repair job workflow type safety
  - Updated `WORKFLOW_RULES` to use `Record<RepairStatus, WorkflowRule>` type
  - Changed `RepairJobWorkflowType.allowed_transitions` to `readonly string[]`
  - Added helper method `includes<T>()` for type-safe readonly array checking
  - Fixed all TypeScript strict mode errors across controllers, services, and middleware

- **Enhanced Repair Estimation Logic**
  - Replaced hardcoded values with `REPAIR_ESTIMATION` configuration
  - Improved complex repair detection with configurable keyword list
  - Added support for Spanish keywords (motor, transmisión, caja)
  - Made complexity multipliers configurable and maintainable

### Fixed
- **TypeScript Type Errors**: Resolved 60+ type errors from enabling strict mode
  - Fixed undefined environment variable errors by using typed `env` module
  - Fixed readonly array type compatibility issues with `.includes()` method
  - Fixed workflow rule type inference issues with proper type annotations
  - Fixed unused parameter warnings in middleware and controllers
  - Fixed potential null/undefined access issues throughout the codebase

### Technical Improvements
- **Code Organization**: Better separation of concerns with centralized configuration
- **Maintainability**: Configuration changes now only require updates in one location
- **Type Safety**: Stricter TypeScript checking catches more potential bugs at compile time
- **Production Readiness**: Database migrations support for zero-downtime deployments
- **Security**: Environment validation prevents running with insecure default values
- **Developer Experience**: Clear error messages when environment is misconfigured

### Breaking Changes
- **Database Seeding**: Seeds now only run when `NODE_ENV=development`
  - Production deployments must use migrations instead of synchronize
  - Existing production deployments should create initial migration before upgrading
- **Environment Variables**: Application will fail to start if any required environment variable is missing
  - All deployments must provide complete `.env` configuration
  - Check `.env.example` for required variables
- **TypeScript Strict Mode**: May surface previously hidden type issues in consuming code
  - All type errors must be resolved for successful compilation

## [1.0.0] 2025-10-29
### Added
- **Customer Pagination System**: Server-side pagination for customer list and search
  - Added page and limit parameters to CustomerService.getAll method
  - Added page and limit parameters to CustomerService.search method
  - Paginated response structure with metadata (data, total, page, limit, totalPages)
  - Skip and take logic for offset-based pagination
  - Default limit of 15 customers per page
  - Total count calculation for pagination metadata
  - Automatic totalPages calculation based on total count and limit
  - findAndCount() usage for efficient query execution

### Changed
- **Enhanced CustomerController for pagination**
  - Updated getAll to parse page and limit query parameters
  - Updated search to parse page and limit query parameters
  - Default values: page=1, limit=15
  - Returns paginated response with metadata instead of raw array
- **Improved CustomerService data retrieval**
  - Modified getAll to return paginated response object
  - Modified search to return paginated response object
  - Maintains ordering by created_at DESC with pagination

### Technical Improvements
- Implemented efficient offset-based pagination with TypeORM
- Optimized database queries using findAndCount for single-query execution
- Proper pagination metadata for frontend integration

## [1.0.0] 2025-10-29
### Added
- **Customer Search Functionality**: Server-side search endpoint for customers
  - Added search method in CustomerService with TypeORM QueryBuilder
  - Case-insensitive search using LOWER() and LIKE operators
  - Searches across customer name and motorcycle plate fields
  - Returns all customers when search query is empty
  - Added CustomerController.search method to handle search requests
  - Added GET /customers/search?q=query route endpoint
  - Search results ordered by creation date (newest first)

### Changed
- **Customer Retrieval Ordering**: Updated CustomerService.getAll to order by created_at DESC
  - Ensures customers are always displayed with newest first
  - Consistent ordering across all customer list views

### Fixed
- **Dashboard Statistics Calculation**: Fixed statistics to use calendar month boundaries instead of rolling 30-day windows
  - Updated `getStatistics` method to calculate statistics based on current calendar month vs previous calendar month
  - Fixed new clients not appearing in statistics immediately after creation
  - Changed date range calculation from "30 days ago" to proper month boundaries (e.g., October 1-31 vs September 1-30)
  - Added precise time boundaries (00:00:00 for month start, 23:59:59 for month end) for accurate data capture
  - Updated variable names for better code clarity (currentMonthStart, currentMonthEnd, previousMonthStart, previousMonthEnd)

### Technical Improvements
- Improved date handling in RepairJob service with proper month boundary calculations
- Enhanced statistics accuracy by using calendar months for business metrics comparison
- Better alignment between backend calculations and frontend display labels

## [1.0.0] 2025-10-26
### Added
- **Enhanced Customer Creation with Comprehensive Validation**
  - Duplicate validation for customer email addresses to prevent duplicate accounts
  - Duplicate validation for customer phone numbers for data integrity
  - Duplicate validation for motorcycle plates to ensure unique vehicle registration
  - Transaction-based customer creation for atomic operations and data consistency
  - Comprehensive error handling with specific Spanish error messages for user feedback

### Changed
- **Improved Customer Service Layer**
  - Enhanced customer creation process with triple-validation system (email, phone, plate)
  - Updated customer retrieval to order by creation date (newest first) for better UI experience
  - Improved error handling with specific BadRequestError types for validation failures
  - Enhanced transaction management to ensure data consistency across customer and motorcycle entities

- **Model Controller Enhancement**
  - Updated model controller to support brand-based filtering with brand_id parameter
  - Improved model retrieval system for frontend dropdown population
  - Enhanced model management for better integration with customer creation flow

### Fixed
- Customer creation data integrity issues with comprehensive duplicate checking
- Race condition prevention in customer and motorcycle creation through proper transaction handling
- Improved error messaging for better user experience during customer registration

## [1.0.0]
### Changed
- Updated repair job statistics to get monthly data
- Cleaned up code for better readability in repairJob.service.ts

## [1.0.0] - 2025-10-19
### Added
- **Enhanced RepairJob Statistics System**: Improved business analytics with comprehensive metrics
  - Daily metrics tracking for jobs completed today and today's revenue
  - Weekly metrics for new customer acquisition tracking  
  - Enhanced statistics endpoint with time-based filtering capabilities
  - Customer entity integration in RepairJob service for cross-entity analytics

### Changed
- Enhanced getStatistics method with date-based calculations for daily and weekly insights
- Improved business intelligence capabilities with real-time performance metrics
- Updated RepairJob service with additional repository dependencies for comprehensive analytics

### Technical Improvements
- Added Customer repository integration in RepairJob service
- Implemented date boundary calculations for accurate time-based metrics
- Enhanced database query optimization with parallel execution using Promise.all()

## [1.0.0] - 2025-10-19
### Added
- **Professional README Documentation**: Complete rewrite with comprehensive project documentation
  - Professional structure with table of contents, feature overview, and technology stack table
  - Full API documentation with endpoint tables and sample requests
  - Complete installation guide with Docker and local setup options
  - Configuration examples with all environment variables
  - Database schema documentation and workflow diagrams
  - Deployment instructions for production environments
  - Business features documentation highlighting repair job workflow system

### Changed
- Updated README from basic documentation to professional standard suitable for production use
- Enhanced project presentation with markdown formatting, tables, and structured sections

## [1.0.0] - 2025-10-19
### Added
- **Complete Repair Job Management System** with comprehensive workflow implementation
  - RepairJob entity with workflow-specific fields (estimated_completion, total_cost, started_at, completed_at)
  - Six-state workflow system: PENDING → IN_REPAIR → WAITING_FOR_PARTS → READY_FOR_PICKUP → COMPLETED → CANCELLED
  - State machine pattern with transition validation and business rules enforcement
  - Automatic cost calculation based on selected services with complexity factors
  - Smart estimated completion date calculation considering service complexity
  - Workflow information endpoints for frontend integration
  - Business statistics dashboard with revenue tracking and completion rates

- **Comprehensive RepairJob API Operations**
  - Create repair jobs with service selection and motorcycle assignment
  - List repair jobs with filtering by status and motorcycle
  - Get detailed repair job information with full relations
  - Update repair job notes and estimated completion dates
  - Update repair job status with workflow validation
  - Cancel repair jobs (with state-based restrictions)
  - Delete repair jobs (only in PENDING or CANCELLED states)
  - Get workflow information for current repair job state
  - Statistics endpoint for business analytics and reporting

- **Enhanced Database Seeding System**
  - RepairJob seeding with sample data across all workflow states
  - Realistic repair scenarios with Spanish notes and proper status distribution
  - Integration with existing customer and motorcycle seed data
  - Comprehensive seeding orchestration in proper dependency order

### Changed
- Enhanced RepairJob entity with additional workflow tracking fields
- Updated server configuration to include RepairJob routes
- Modified seed system to include repair job data generation

## [1.0.0] - 2025-10-19
### Added
- **Complete Service Management System** for repair shop operations
  - Service entity with name, pricing, and activation status
  - Service controller with full CRUD operations (create, read, update, delete)
  - Service service layer with comprehensive business logic and validation
  - Service routes with authentication protection and input validation
  - Service seeding system with realistic motorcycle repair services
  - Integration with RepairJob system for service-job associations

- **Profile Management Enhancement**
  - Profile endpoint for authenticated user information retrieval
  - Enhanced authentication middleware with profile access support

- **Code Quality Improvements**
  - Comprehensive ESLint configuration and warning resolution
  - Standardized API field naming convention using snake_case
  - Enhanced TypeScript type definitions for services and repair operations
  - Improved code structure and maintainability

### Changed
- Streamlined customer and motorcycle type definitions for better consistency
- Updated authentication system to use snake_case field naming (remember_me)
- Enhanced error handling with Spanish localization for better user experience
- Removed redundant try-catch blocks in favor of centralized error handling
- Updated authentication routes to support new field naming conventions

### Fixed
- Resolved all ESLint warnings across the codebase
- Improved type safety with proper TypeScript imports
- Enhanced code consistency with standardized naming patterns

## [1.0.0] - 2025-10-19
### Added
- **Customer and Motorcycle Seeding System** with comprehensive test data
  - Customer seeding with realistic Salvadoran names, emails, and phone numbers
  - Motorcycle seeding with proper plate number format (M + 6 digits)
  - Realistic brand and model associations for motorcycles
  - Customer-motorcycle relationship creation with proper foreign key associations
  - Duplicate prevention logic to avoid re-seeding existing data
  - Enhanced seeding orchestration with proper dependency management

### Changed
- Enhanced seeding system with realistic data for development and testing
- Updated seed orchestration to include customer and motorcycle data generation
- Improved database relationships with proper entity associations

## [1.0.0] - 2025-10-19
### Added
- Complete Customer Management System with motorcycle integration
- Customer controller with full CRUD operations (create, read, update, delete)
- Customer service layer with transactional operations for data integrity
- Customer routes with comprehensive validation and authentication protection
- OneToOne relationship between Customer and Motorcycle entities for better data modeling
- TypeScript types for Customer and Motorcycle entities with proper type safety
- Enhanced validation with snake_case field naming convention for API consistency
- Customer-Motorcycle transactional creation for atomic operations

### Changed
- Enhanced error handling across all controllers (auth, brand, model, customer)
- Added try-catch blocks with proper error logging and status codes
- Updated Customer entity from OneToMany to OneToOne relationship with Motorcycle
- Updated Motorcycle entity to use OneToOne relationship with Customer
- Improved error messages with specific context for different operations
- Enhanced server configuration to include customer routes

### Fixed
- Consistent error handling patterns across all API endpoints
- Proper HTTP status codes for different error scenarios (404 for not found, 500 for server errors)
- Database relationship integrity with proper cascade operations

## [1.0.0] - 2025-10-18
### Added
- Comprehensive brand seeding system with 12 motorcycle brands
- Model seeding system with 50+ real motorcycle models across all brands
- Cloudinary CDN integration for optimized brand logo delivery
- WebP format support for brand logos with better compression
- Duplicate prevention logic in seeding to avoid re-seeding existing data
- Real motorcycle model names for authentic data representation
- Proper brand-model relationships in seed data
- Enhanced seed orchestration with automatic execution order

## [1.0.0] - 2025-10-18
### Added
- Complete CRUD API for Brand management with authentication protection
- Complete CRUD API for Model management with authentication protection
- Brand controller with create, read, update, and delete operations
- Model controller with create, read, update, and delete operations
- Brand service layer for database operations and business logic
- Model service layer for database operations and business logic
- Comprehensive validation for brand routes (name validation, URL validation)
- Comprehensive validation for model routes with UUID parameter validation
- Bearer token authentication middleware for API protection
- Spanish localization for authentication error messages
- TypeScript types for Brand and Model entities

### Changed
- Enhanced authentication middleware with Bearer token support
- Updated authentication middleware error handling with proper HTTP status codes
- Improved error messages in auth service with Spanish localization
- Renamed `Login` type to `LoginType` for better naming consistency
- Updated authentication middleware to use UnauthorizedError and NotFoundError instead of BadRequestError

## [1.0.0] - 2025-10-17
### Added
- Cookie-based authentication system with HTTP-only cookies for enhanced security
- JWT token verification functionality for protected routes
- Authentication middleware for verifying JWT tokens from cookies
- Cookie parser middleware integration for handling cookies
- Logout functionality to clear authentication cookies
- Token verification endpoint to validate user authentication status
- Enhanced CORS configuration with credentials support
- Support for "Remember Me" functionality with extended token expiration

### Changed
- Modified login endpoint to set HTTP-only cookies instead of returning JWT tokens directly
- Updated authentication service to include token verification method
- Enhanced token utilities with JWT verification function
- Improved authentication controller with logout and verify methods
- Updated authentication routes with new logout and verify endpoints
- Modified CORS configuration to support credentials for cookie-based authentication

### Dependencies
- Added `cookie-parser` package for cookie handling
- Added `@types/cookie-parser` for TypeScript support

## [1.0.0] - 2025-10-12
### Added
- Initial release of the MossBros backend with PostgreSQL and Redis services.
- Docker Compose setup for easy deployment.
- Environment configuration for database connection.
- Basic project structure and documentation.
- README file with setup instructions.
- .gitignore file to exclude unnecessary files from version control.
- Bcrypt utilities for secure password hashing.
- CORS configuration to allow requests from the frontend.
- Nodemailer setup for sending emails.
- Error handling middleware for consistent error responses.
- Validation middleware for request data validation.
- Utility functions for token generation and email sending.
- User entity and repository for managing user data.
- User seeding script to create an initial owner user.
- Logging setup for monitoring application activity.
- Authentication routes, controller and service.